<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Debugging · CUDA.jl</title><meta name="title" content="Debugging · CUDA.jl"/><meta property="og:title" content="Debugging · CUDA.jl"/><meta property="twitter:title" content="Debugging · CUDA.jl"/><meta name="description" content="Documentation for CUDA.jl."/><meta property="og:description" content="Documentation for CUDA.jl."/><meta property="twitter:description" content="Documentation for CUDA.jl."/><meta property="og:url" content="https://cuda.juliagpu.org/stable/development/debugging/"/><meta property="twitter:url" content="https://cuda.juliagpu.org/stable/development/debugging/"/><link rel="canonical" href="https://cuda.juliagpu.org/stable/development/debugging/"/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-154489943-2"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-154489943-2', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="CUDA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CUDA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/introduction/">Introduction</a></li><li><a class="tocitem" href="../../tutorials/custom_structs/">Using custom structs</a></li><li><a class="tocitem" href="../../tutorials/performance/">Performance Tips</a></li></ul></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../../installation/overview/">Overview</a></li><li><a class="tocitem" href="../../installation/conditional/">Conditional use</a></li><li><a class="tocitem" href="../../installation/troubleshooting/">Troubleshooting</a></li></ul></li><li><span class="tocitem">Usage</span><ul><li><a class="tocitem" href="../../usage/overview/">Overview</a></li><li><a class="tocitem" href="../../usage/workflow/">Workflow</a></li><li><a class="tocitem" href="../../usage/array/">Array programming</a></li><li><a class="tocitem" href="../../usage/memory/">Memory management</a></li><li><a class="tocitem" href="../../usage/multitasking/">Tasks and threads</a></li><li><a class="tocitem" href="../../usage/multigpu/">Multiple GPUs</a></li></ul></li><li><span class="tocitem">Development</span><ul><li><a class="tocitem" href="../profiling/">Benchmarking &amp; profiling</a></li><li><a class="tocitem" href="../kernel/">Kernel programming</a></li><li><a class="tocitem" href="../troubleshooting/">Troubleshooting</a></li><li class="is-active"><a class="tocitem" href>Debugging</a><ul class="internal"><li><a class="tocitem" href="#Adding-output-statements"><span>Adding output statements</span></a></li><li><a class="tocitem" href="#Stack-trace-information"><span>Stack trace information</span></a></li><li><a class="tocitem" href="#Debug-info-and-line-number-information"><span>Debug info and line-number information</span></a></li><li><a class="tocitem" href="#compute-sanitizer"><span><code>compute-sanitizer</code></span></a></li><li><a class="tocitem" href="#cuda-gdb"><span><code>cuda-gdb</code></span></a></li></ul></li></ul></li><li><span class="tocitem">API reference</span><ul><li><a class="tocitem" href="../../api/essentials/">Essentials</a></li><li><a class="tocitem" href="../../api/array/">Array programming</a></li><li><a class="tocitem" href="../../api/kernel/">Kernel programming</a></li><li><a class="tocitem" href="../../api/compiler/">Compiler</a></li></ul></li><li><span class="tocitem">Library reference</span><ul><li><a class="tocitem" href="../../lib/driver/">CUDA driver</a></li></ul></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Development</a></li><li class="is-active"><a href>Debugging</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Debugging</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaGPU/CUDA.jl/blob/master/docs/src/development/debugging.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Debugging"><a class="docs-heading-anchor" href="#Debugging">Debugging</a><a id="Debugging-1"></a><a class="docs-heading-anchor-permalink" href="#Debugging" title="Permalink"></a></h1><p>Even if your kernel executes, it may be computing the wrong values, or even error at run time. To debug these issues, both CUDA.jl and the CUDA toolkit provide several utilities. These are generally low-level, since we generally cannot use the full extend of the Julia programming language and its tools within GPU kernels.</p><h2 id="Adding-output-statements"><a class="docs-heading-anchor" href="#Adding-output-statements">Adding output statements</a><a id="Adding-output-statements-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-output-statements" title="Permalink"></a></h2><p>The easiest, and often reasonably effective way to debug GPU code is to visualize intermediary computations using output functions. CUDA.jl provides several macros that facilitate this style of debugging:</p><ul><li><code>@cushow</code> (like <code>@show</code>): to visualize an expression, its result, and return that value. This makes it easy to wrap expressions without disturbing their execution.</li><li><code>@cuprintln</code> (like <code>println</code>): to print text and values. This macro does support string interpolation, but the types it can print are restricted to C primitives.</li></ul><p>The <code>@cuassert</code> macro (like <code>@assert</code>) can also be useful to find issues and abort execution.</p><h2 id="Stack-trace-information"><a class="docs-heading-anchor" href="#Stack-trace-information">Stack trace information</a><a id="Stack-trace-information-1"></a><a class="docs-heading-anchor-permalink" href="#Stack-trace-information" title="Permalink"></a></h2><p>If you run into run-time exceptions, stack trace information will by default be very limited. For example, given the following out-of-bounds access:</p><pre><code class="language-julia hljs">julia&gt; function kernel(a)
         a[threadIdx().x] = 0
         return
       end
kernel (generic function with 1 method)

julia&gt; @cuda threads=2 kernel(CuArray([1]))</code></pre><p>If we execute this code, we&#39;ll get a very short error message:</p><pre><code class="nohighlight hljs">ERROR: a exception was thrown during kernel execution.
Run Julia on debug level 2 for device stack traces.</code></pre><p>As the message suggests, we can have CUDA.jl emit more rich stack trace information by setting Julia&#39;s debug level to 2 or higher by passing <code>-g2</code> to the <code>julia</code> invocation:</p><pre><code class="nohighlight hljs">ERROR: a exception was thrown during kernel execution.
Stacktrace:
 [1] throw_boundserror at abstractarray.jl:541
 [2] checkbounds at abstractarray.jl:506
 [3] arrayset at /home/tim/Julia/pkg/CUDA/src/device/array.jl:84
 [4] setindex! at /home/tim/Julia/pkg/CUDA/src/device/array.jl:101
 [5] kernel at REPL[4]:2</code></pre><p>Note that these messages are embedded in the module (CUDA does not support stack unwinding), and thus bloat its size. To avoid any overhead, you can disable these messages by setting the debug level to 0 (passing <code>-g0</code> to <code>julia</code>). This disabled any device-side message, but retains the host-side detection:</p><pre><code class="nohighlight hljs">julia&gt; @cuda threads=2 kernel(CuArray([1]))
# no device-side error message!

julia&gt; synchronize()
ERROR: KernelException: exception thrown during kernel execution</code></pre><h2 id="Debug-info-and-line-number-information"><a class="docs-heading-anchor" href="#Debug-info-and-line-number-information">Debug info and line-number information</a><a id="Debug-info-and-line-number-information-1"></a><a class="docs-heading-anchor-permalink" href="#Debug-info-and-line-number-information" title="Permalink"></a></h2><p>Setting the debug level does not only enrich stack traces, it also changes the debug info emitted in the CUDA module. On debug level 1, which is the default setting if unspecified, CUDA.jl emits line number information corresponding to <code>nvcc -lineinfo</code>. This information does not hurt performance, and is used by a variety of tools to improve the debugging experience.</p><p>To emit actual debug info as <code>nvcc -G</code> does, you need to start Julia on debug level 2 by passing the flag <code>-g2</code>. Support for emitting PTX-compatible debug info is a recent addition to the NVPTX LLVM back-end, so it&#39;s possible this information is incorrect or otherwise affects compilation.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Due to bugs in <code>ptxas</code>, you need CUDA 11.5 or higher for debug info support.</p></div></div><p>To disable all debug info emission, start Julia with the flag <code>-g0</code>.</p><h2 id="compute-sanitizer"><a class="docs-heading-anchor" href="#compute-sanitizer"><code>compute-sanitizer</code></a><a id="compute-sanitizer-1"></a><a class="docs-heading-anchor-permalink" href="#compute-sanitizer" title="Permalink"></a></h2><p>To debug kernel issues like memory errors or race conditions, you can use CUDA&#39;s <code>compute-sanitizer</code> tool. Refer to the <a href="https://docs.nvidia.com/compute-sanitizer/ComputeSanitizer/index.html#using-compute-sanitizer">manual</a> for more information.</p><p>To use <code>compute-sanitizer</code>, you need to install the <code>CUDA_SDK_jll</code> package in your environment first.</p><p>To spawn a new Julia session under <code>compute-sanitizer</code>:</p><pre><code class="nohighlight hljs">julia&gt; using CUDA_SDK_jll

# Get location of compute_sanitizer executable
julia&gt; compute_sanitizer = joinpath(CUDA_SDK_jll.artifact_dir, &quot;cuda/compute-sanitizer/compute-sanitizer&quot;)
.julia/artifacts/feb6b469b6047f344fec54df2619d65f6b704bdb/cuda/compute-sanitizer/compute-sanitizer

# Recommended options for use with Julia and CUDA.jl
julia&gt; options = [&quot;--launch-timeout=0&quot;, &quot;--target-processes=all&quot;, &quot;--report-api-errors=no&quot;]
3-element Vector{String}:
 &quot;--launch-timeout=0&quot;
 &quot;--target-processes=all&quot;
 &quot;--report-api-errors=no&quot;

# Run the executable with Julia
julia&gt; run(`$compute_sanitizer $options $(Base.julia_cmd())`)
========= COMPUTE-SANITIZER
julia&gt; using CUDA

julia&gt; CuArray([1]) .+ 1
1-element CuArray{Int64, 1, CUDA.DeviceMemory}:
 2

julia&gt; exit()
========= ERROR SUMMARY: 0 errors
Process(`.julia/artifacts/feb6b469b6047f344fec54df2619d65f6b704bdb/cuda/compute-sanitizer/compute-sanitizer --launch-timeout=0 --target-processes=all --report-api-errors=no julia`, ProcessExited(0))</code></pre><p>By default, <code>compute-sanitizer</code> launches the <code>memcheck</code> tool, which is great for dealing with memory issues. Other tools can be selected with the <code>--tool</code> argument, e.g., to find thread synchronization hazards use <code>--tool synccheck</code>, <code>racecheck</code> can be used to find shared memory data races, and <code>initcheck</code> is useful for spotting uses of uninitialized device memory.</p><h2 id="cuda-gdb"><a class="docs-heading-anchor" href="#cuda-gdb"><code>cuda-gdb</code></a><a id="cuda-gdb-1"></a><a class="docs-heading-anchor-permalink" href="#cuda-gdb" title="Permalink"></a></h2><p>To debug Julia code, you can use the CUDA debugger <code>cuda-gdb</code>. When using this tool, it is recommended to enable Julia debug mode 2 so that debug information is emitted. Do note that the DWARF info emitted by Julia is currently insufficient to e.g. inspect variables, so the debug experience will not be pleasant.</p><p>If you encounter the <code>CUDBG_ERROR_UNINITIALIZED</code> error, ensure all your devices are supported by <code>cuda-gdb</code> (e.g., Kepler-era devices aren&#39;t). If some aren&#39;t, re-start Julia with <code>CUDA_VISIBLE_DEVICES</code> set to ignore that device.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../troubleshooting/">« Troubleshooting</a><a class="docs-footer-nextpage" href="../../api/essentials/">Essentials »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Wednesday 18 September 2024 12:14">Wednesday 18 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
