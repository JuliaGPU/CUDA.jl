<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Debugging · CUDA.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-154489943-2"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-154489943-2', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://cuda.juliagpu.org/stable/development/debugging/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="CUDA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CUDA.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/introduction/">Introduction</a></li><li><a class="tocitem" href="../../tutorials/custom_structs/">Using custom structs</a></li></ul></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../../installation/overview/">Overview</a></li><li><a class="tocitem" href="../../installation/conditional/">Conditional use</a></li><li><a class="tocitem" href="../../installation/troubleshooting/">Troubleshooting</a></li></ul></li><li><span class="tocitem">Usage</span><ul><li><a class="tocitem" href="../../usage/overview/">Overview</a></li><li><a class="tocitem" href="../../usage/workflow/">Workflow</a></li><li><a class="tocitem" href="../../usage/array/">Array programming</a></li><li><a class="tocitem" href="../../usage/memory/">Memory management</a></li><li><a class="tocitem" href="../../usage/multitasking/">Tasks and threads</a></li><li><a class="tocitem" href="../../usage/multigpu/">Multiple GPUs</a></li></ul></li><li><span class="tocitem">Development</span><ul><li><a class="tocitem" href="../profiling/">Profiling</a></li><li><a class="tocitem" href="../troubleshooting/">Troubleshooting</a></li><li class="is-active"><a class="tocitem" href>Debugging</a><ul class="internal"><li><a class="tocitem" href="#Adding-output-statements"><span>Adding output statements</span></a></li><li><a class="tocitem" href="#Stack-trace-information"><span>Stack trace information</span></a></li><li><a class="tocitem" href="#Debug-info-and-line-number-information"><span>Debug info and line-number information</span></a></li><li><a class="tocitem" href="#compute-sanitizer"><span><code>compute-sanitizer</code></span></a></li><li><a class="tocitem" href="#cuda-gdb"><span><code>cuda-gdb</code></span></a></li></ul></li></ul></li><li><span class="tocitem">API reference</span><ul><li><a class="tocitem" href="../../api/essentials/">Essentials</a></li><li><a class="tocitem" href="../../api/compiler/">Compiler</a></li><li><a class="tocitem" href="../../api/kernel/">Kernel programming</a></li><li><a class="tocitem" href="../../api/array/">Array programming</a></li></ul></li><li><span class="tocitem">Library reference</span><ul><li><a class="tocitem" href="../../lib/driver/">CUDA driver</a></li></ul></li><li><a class="tocitem" href="../../faq/">FAQ</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Development</a></li><li class="is-active"><a href>Debugging</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Debugging</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaGPU/CUDA.jl/blob/master/docs/src/development/debugging.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Debugging"><a class="docs-heading-anchor" href="#Debugging">Debugging</a><a id="Debugging-1"></a><a class="docs-heading-anchor-permalink" href="#Debugging" title="Permalink"></a></h1><p>Even if your kernel executes, it may be computing the wrong values, or even error at run time. To debug these issues, both CUDA.jl and the CUDA toolkit provide several utilities. These are generally low-level, since we generally cannot use the full extend of the Julia programming language and its tools within GPU kernels.</p><h2 id="Adding-output-statements"><a class="docs-heading-anchor" href="#Adding-output-statements">Adding output statements</a><a id="Adding-output-statements-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-output-statements" title="Permalink"></a></h2><p>The easiest, and often reasonably effective way to debug GPU code is to visualize intermediary computations using output functions. CUDA.jl provides several macros that facilitate this style of debugging:</p><ul><li><code>@cushow</code> (like <code>@show</code>): to visualize an expression, its result, and return that value. This makes it easy to wrap expressions without disturbing their execution.</li><li><code>@cuprintln</code> (like <code>println</code>): to print text and values. This macro does support string interpolation, but the types it can print are restricted to C primitives.</li></ul><p>The <code>@cuaassert</code> macro (like <code>@assert</code>) can also be useful to find issues and abort execution.</p><h2 id="Stack-trace-information"><a class="docs-heading-anchor" href="#Stack-trace-information">Stack trace information</a><a id="Stack-trace-information-1"></a><a class="docs-heading-anchor-permalink" href="#Stack-trace-information" title="Permalink"></a></h2><p>If you run into run-time exceptions, stack trace information will by default be very limited. For example, given the following out-of-bounds access:</p><pre><code class="language-julia hljs">julia&gt; function kernel(a)
         a[threadIdx().x] = 0
         return
       end
kernel (generic function with 1 method)

julia&gt; @cuda threads=2 kernel(CuArray([1]))</code></pre><p>If we execute this code, we&#39;ll get a very short error message:</p><pre><code class="nohighlight hljs">ERROR: a exception was thrown during kernel execution.
Run Julia on debug level 2 for device stack traces.</code></pre><p>As the message suggests, we can have CUDA.jl emit more rich stack trace information by setting Julia&#39;s debug level to 2 or higher by passing <code>-g2</code> to the <code>julia</code> invocation:</p><pre><code class="nohighlight hljs">ERROR: a exception was thrown during kernel execution.
Stacktrace:
 [1] throw_boundserror at abstractarray.jl:541
 [2] checkbounds at abstractarray.jl:506
 [3] arrayset at /home/tim/Julia/pkg/CUDA/src/device/array.jl:84
 [4] setindex! at /home/tim/Julia/pkg/CUDA/src/device/array.jl:101
 [5] kernel at REPL[4]:2</code></pre><p>Note that these messages are embedded in the module (CUDA does not support stack unwinding), and thus bloat its size. To avoid any overhead, you can disable these messages by setting the debug level to 0 (passing <code>-g0</code> to <code>julia</code>). This disabled any device-side message, but retains the host-side detection:</p><pre><code class="nohighlight hljs">julia&gt; @cuda threads=2 kernel(CuArray([1]))
# no device-side error message!

julia&gt; synchronize()
ERROR: KernelException: exception thrown during kernel execution</code></pre><h2 id="Debug-info-and-line-number-information"><a class="docs-heading-anchor" href="#Debug-info-and-line-number-information">Debug info and line-number information</a><a id="Debug-info-and-line-number-information-1"></a><a class="docs-heading-anchor-permalink" href="#Debug-info-and-line-number-information" title="Permalink"></a></h2><p>Setting the debug level does not only enrich stack traces, it also changes the debug info emitted in the CUDA module. On debug level 1, which is the default setting if unspecified, CUDA.jl emits line number information corresponding to <code>nvcc -lineinfo</code>. This information does not hurt performance, and is used by a variety of tools to improve the debugging experience.</p><p>To emit actual debug info as <code>nvcc -G</code> does, you need to start Julia on debug level 2 by passing the flag <code>-g2</code>. Support for emitting PTX-compatible debug info is a recent addition to the NVPTX LLVM back-end, so it&#39;s possible this information is incorrect or otherwise affects compilation.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Due to bugs in <code>ptxas</code>, you need CUDA 11.5 or higher for debug info support.</p></div></div><p>To disable all debug info emission, start Julia with the flag <code>-g0</code>.</p><h2 id="compute-sanitizer"><a class="docs-heading-anchor" href="#compute-sanitizer"><code>compute-sanitizer</code></a><a id="compute-sanitizer-1"></a><a class="docs-heading-anchor-permalink" href="#compute-sanitizer" title="Permalink"></a></h2><p>To debug kernel issues like memory errors or race conditions, you can use CUDA&#39;s <code>compute-sanitizer</code> tool. Refer to the <a href="https://docs.nvidia.com/compute-sanitizer/ComputeSanitizer/index.html#using-compute-sanitizer">manual</a> for more information.</p><p>To facilitate using the compute sanitizer, CUDA.jl ships the tool as part of its artifacts. You can get the path to the tool using the following function:</p><pre><code class="nohighlight hljs">julia&gt; using CUDA

julia&gt; CUDA.compute_sanitizer()
&quot;.julia/artifacts/7b09e1deca842d1e5467b6f7a8ec5a96d47ae0b4/bin/compute-sanitizer&quot;

# including recommended options for use with Julia and CUDA.jl
julia&gt; CUDA.compute_sanitizer_cmd()
`.julia/artifacts/7b09e1deca842d1e5467b6f7a8ec5a96d47ae0b4/bin/compute-sanitizer --tool memcheck --launch-timeout=0 --target-processes=all --report-api-errors=no`</code></pre><p>To quickly spawn a new Julia session under <code>compute-sanitizer</code>, another helper function is provided:</p><pre><code class="nohighlight hljs">julia&gt; CUDA.run_compute_sanitizer()
Re-starting your active Julia session...

========= COMPUTE-SANITIZER
julia&gt; using CUDA

julia&gt; CuArray([1]) .+ 1
1-element CuArray{Int64, 1, CUDA.Mem.DeviceBuffer}:
 2

julia&gt; exit()
========= ERROR SUMMARY: 0 errors
Process(`.julia/artifacts/7b09e1deca842d1e5467b6f7a8ec5a96d47ae0b4/bin/compute-sanitizer --tool memcheck --launch-timeout=0 --target-processes=all --report-api-errors=no julia -g1`, ProcessExited(0))</code></pre><h2 id="cuda-gdb"><a class="docs-heading-anchor" href="#cuda-gdb"><code>cuda-gdb</code></a><a id="cuda-gdb-1"></a><a class="docs-heading-anchor-permalink" href="#cuda-gdb" title="Permalink"></a></h2><p>To debug Julia code, you can use the CUDA debugger <code>cuda-gdb</code>. When using this tool, it is recommended to enable Julia debug mode 2 so that debug information is emitted. Do note that the DWARF info emitted by Julia is currently insufficient to e.g. inspect variables, so the debug experience will not be pleasant.</p><p>If you encounter the <code>CUDBG_ERROR_UNINITIALIZED</code> error, ensure all your devices are supported by <code>cuda-gdb</code> (e.g., Kepler-era devices aren&#39;t). If some aren&#39;t, re-start Julia with <code>CUDA_VISIBLE_DEVICES</code> set to ignore that device.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../troubleshooting/">« Troubleshooting</a><a class="docs-footer-nextpage" href="../../api/essentials/">Essentials »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Tuesday 13 June 2023 21:32">Tuesday 13 June 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
